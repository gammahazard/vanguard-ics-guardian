// ============================================================
// vanguard:containment - simplified capability interface
// ============================================================
//
// this is the "polyfill approach": we define local interfaces that
// mirror wasi behavior without depending on the official registry.
//
// why this approach?
// - the wasi 0.2 registry tooling had compatibility issues
// - this demonstrates the SAME capability-based security model
// - the guest/host security boundary works identically
//
// the key insight: whether you call it wasi:filesystem or sensor-fs,
// the HOST still controls what the guest can actually do.
// ============================================================

package vanguard:containment@0.1.0;

// ------------------------------------------------------------
// sensor-utils: logging and utility capabilities
// ------------------------------------------------------------
// allows the guest to communicate its actions to the host console.
// this makes the "struggle" of blocked malware visible to viewers.
//
interface sensor-utils {
    // print a message to the host console
    // the host controls how (and whether) this is displayed
    log: func(msg: string);
}

// ------------------------------------------------------------
// sensor-fs: represents filesystem capabilities
// ------------------------------------------------------------
// this mirrors wasi:filesystem behavior:
// - the guest can request to read files
// - the host decides whether to allow or deny
//
interface sensor-fs {
    // read a file from the virtual filesystem
    // returns: Ok(content) if allowed, Err(reason) if denied
    read-file: func(path: string) -> result<string, string>;
}

// ------------------------------------------------------------
// sensor-net: represents network capabilities
// ------------------------------------------------------------
// this mirrors wasi:sockets behavior:
// - the guest can request to send data over the network
// - the host can block this (data diode) or allow it (breach)
//
interface sensor-net {
    // attempt to send telemetry data to external server
    // returns: Ok(bytes-sent) if allowed, Err(reason) if blocked
    send-telemetry: func(data: string) -> result<u32, string>;
}

// ------------------------------------------------------------
// the world: what the guest component requests
// ------------------------------------------------------------
world ics-guardian {
    // import capabilities the guest wants
    import sensor-utils;  // logging - so guest can narrate
    import sensor-fs;     // filesystem access
    import sensor-net;    // network access (blocked by data diode)
    
    // export the entry point the host calls
    export run: func();
}
